<?xml version="1.0" ?>
<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">
    <services>
        <!-- Controllers -->
        <service id="SwagUcp\Controller\DiscoveryController">
            <argument type="service" id="SwagUcp\Service\DiscoveryService"/>
            <argument type="service" id="SwagUcp\Service\PaymentHandlerService"/>
            <argument type="service" id="router"/>
            <tag name="controller.service_arguments"/>
        </service>

        <service id="SwagUcp\Controller\CheckoutController">
            <argument type="service" id="SwagUcp\Service\CheckoutService"/>
            <argument type="service" id="SwagUcp\Service\CapabilityNegotiationService"/>
            <argument type="service" id="SwagUcp\Service\SchemaValidationService"/>
            <argument type="service" id="SwagUcp\Mapper\CheckoutMapper"/>
            <argument type="service" id="SwagUcp\Service\SignatureVerificationService"/>
            <argument type="service" id="SwagUcp\Service\AgentAuthorizationService"/>
            <tag name="controller.service_arguments"/>
        </service>

        <!-- Core Services -->
        <service id="SwagUcp\Service\DiscoveryService">
            <argument type="service" id="Shopware\Core\System\SystemConfig\SystemConfigService"/>
            <argument type="service" id="SwagUcp\Service\KeyManagementService"/>
        </service>

        <service id="SwagUcp\Service\CheckoutService">
            <argument type="service" id="Shopware\Core\Checkout\Cart\SalesChannel\CartService"/>
            <argument type="service" id="SwagUcp\Repository\UcpCheckoutSessionRepository"/>
            <argument type="service" id="Shopware\Core\Checkout\Order\SalesChannel\OrderService"/>
            <argument type="service" id="SwagUcp\Service\PaymentProcessingService"/>
        </service>

        <service id="SwagUcp\Service\CapabilityNegotiationService"/>

        <service id="SwagUcp\Service\SchemaValidationService">
            <argument type="service" id="SwagUcp\Service\SchemaLoaderService"/>
        </service>

        <service id="SwagUcp\Service\SchemaLoaderService">
            <argument>%kernel.project_dir%/custom/plugins/SwagUcp/src/Resources/schemas</argument>
        </service>

        <service id="SwagUcp\Service\PaymentHandlerService">
            <argument type="service" id="router"/>
        </service>

        <service id="SwagUcp\Service\PaymentProcessingService">
            <argument type="service" id="Shopware\Core\Checkout\Payment\PaymentProcessor"/>
        </service>

        <!-- Security Services -->
        <service id="SwagUcp\Service\KeyManagementService">
            <argument type="service" id="Shopware\Core\System\SystemConfig\SystemConfigService"/>
        </service>

        <service id="SwagUcp\Service\SignatureVerificationService">
            <argument type="service" id="SwagUcp\Service\KeyManagementService"/>
        </service>

        <service id="SwagUcp\Service\PlatformProfileService">
            <argument type="service" id="http_client" on-invalid="null"/>
        </service>

        <service id="SwagUcp\Service\WebhookService">
            <argument type="service" id="SwagUcp\Service\SignatureVerificationService"/>
            <argument type="service" id="http_client" on-invalid="null"/>
            <argument type="service" id="logger" on-invalid="null"/>
        </service>

        <service id="SwagUcp\Service\AgentAuthorizationService">
            <argument type="service" id="Shopware\Core\System\SystemConfig\SystemConfigService"/>
            <argument type="service" id="SwagUcp\Service\SignatureVerificationService"/>
            <argument type="service" id="SwagUcp\Service\PlatformProfileService"/>
            <argument type="service" id="logger" on-invalid="null"/>
        </service>

        <!-- Mappers -->
        <service id="SwagUcp\Mapper\CheckoutMapper">
            <argument type="service" id="Shopware\Core\Checkout\Cart\SalesChannel\CartService"/>
            <argument type="service" id="SwagUcp\Service\PaymentHandlerService"/>
            <argument type="service" id="router"/>
        </service>

        <!-- Repositories -->
        <service id="SwagUcp\Repository\UcpCheckoutSessionRepository">
            <argument type="service" id="Doctrine\DBAL\Connection"/>
        </service>
    </services>
</container>
